# claudy CLIコマンドリファレンス

このドキュメントは、claudyの全コマンドの詳細な使用方法を説明します。

## 目次

- [概要](#概要)
- [グローバルオプション](#グローバルオプション)
- [コマンド一覧](#コマンド一覧)
  - [init](#init)
  - [save](#save)
  - [load](#load)
  - [list](#list)
  - [delete](#delete)
  - [migrate](#migrate)
- [使用例とワークフロー](#使用例とワークフロー)
- [トラブルシューティング](#トラブルシューティング)
- [FAQ](#faq)

## 概要

claudyは、Claude AIの設定ファイル（CLAUDE.md、.claude/commands/**/*.md）を名前付きセットとして保存・管理するCLIツールです。プロジェクトごとに異なる設定を簡単に切り替えることができます。

### 基本的な使い方

```bash
# 現在の設定を保存
claudy save myproject

# 保存済みセットの一覧を表示
claudy list

# 保存済みの設定を展開
claudy load myproject

# 不要なセットを削除
claudy delete old-project
```

## グローバルオプション

すべてのコマンドで使用可能なオプション：

| オプション | 短縮形 | 説明 |
|-----------|--------|------|
| `--version` | `-V` | claudyのバージョンを表示 |
| `--help` | `-h` | ヘルプを表示 |
| `--verbose` | `-v` | 詳細なログを表示（デバッグ用） |
| `--profile <profile>` | `-p` | 使用するプロファイルを指定（将来実装予定） |

### 使用例

```bash
# バージョン確認
claudy --version

# 詳細ログを有効にしてコマンド実行
claudy save myproject --verbose

# コマンドのヘルプを表示
claudy save --help
```

## コマンド一覧

### init

claudy設定を初期化します。

```bash
claudy init
```

#### 説明

現在のプロジェクトにclaudyの設定ディレクトリ（`.claudy/`）を作成し、初期設定を行います。このコマンドは通常、プロジェクトでclaudyを初めて使用する際に実行します。

#### オプション

このコマンドには固有のオプションはありません。

#### 実行例

```bash
# プロジェクトのルートディレクトリで実行
cd ~/projects/my-app
claudy init
```

### save

Claude設定ファイルを名前付きセットとして保存します。

```bash
claudy save <name> [options]
```

#### 説明

現在のディレクトリにあるClaude AI設定ファイルを指定した名前のセットとして保存します。デフォルトではインタラクティブモードで動作し、保存するファイルを選択できます。

#### オプション

| オプション | 短縮形 | 説明 |
|-----------|--------|------|
| `--force` | `-f` | 既存のセットを確認なしで上書き |
| `--all` | `-a` | 全ファイルを自動的に保存（インタラクティブ選択をスキップ） |
| `--interactive` | `-i` | **廃止予定** - デフォルトでインタラクティブモードが有効です |

#### 保存対象ファイル

**プロジェクトレベル：**
- `CLAUDE.md` - プロジェクトの指示書
- `CLAUDE.local.md` - ローカル設定（存在する場合）
- `.claude/**/*.md` - カスタムコマンド

**ユーザーレベル（デフォルトで選択可能）：**
- `~/.claude/CLAUDE.md` - グローバル設定
- `~/.claude/commands/**/*.md` - グローバルコマンド

#### 実行例

```bash
# インタラクティブにファイルを選択して保存（デフォルト）
claudy save myproject

# 全ファイルを自動的に保存
claudy save frontend -a

# 既存のセットを強制的に上書き
claudy save backend -f

# 全ファイルを自動保存し、既存セットを上書き
claudy save project-v2 -a -f

# 詳細ログを表示しながら保存
claudy save debug-config -v
```

#### 使用できないセット名

以下の名前は使用できません：
- 空文字列
- 特殊文字（/, \, :, *, ?, ", <, >, |）を含む名前
- 255文字を超える名前
- 予約名「profiles」

### load

保存済みの設定セットを現在のディレクトリに展開します。

```bash
claudy load <name> [options]
```

#### 説明

指定したセットのファイルを現在のディレクトリに展開（コピー）します。既存ファイルが存在する場合は、バックアップ作成、上書き、キャンセルのいずれかを選択できます。

#### オプション

| オプション | 短縮形 | 説明 |
|-----------|--------|------|
| `--force` | `-f` | 確認なしで既存ファイルを上書き |

#### 既存ファイルの処理

既存ファイルとの衝突が検出された場合の処理オプション：
1. **バックアップ作成** - 既存ファイルを`.bak`拡張子でバックアップ
2. **上書き** - 既存ファイルを上書き
3. **キャンセル** - 処理を中止

#### 実行例

```bash
# 基本的な使用方法
claudy load frontend

# 既存ファイルを強制的に上書き
claudy load backend -f

# 別ディレクトリで展開
cd ~/projects/new-app
claudy load template

# 詳細ログを表示しながら展開
claudy load myproject -v
```

#### エラー時の動作

ファイル展開中にエラーが発生した場合、自動的にロールバック処理が実行され、変更前の状態に戻ります。

### list

保存済みセットの一覧を表示します。

```bash
claudy list
```

#### 説明

現在のプロジェクトに保存されているすべてのセットをテーブル形式で表示します。各セットの名前、作成日時、含まれるファイル数が確認できます。

#### オプション

このコマンドには固有のオプションはありません。

#### 表示形式

```
保存済みセット:
┌──────────────┬─────────────────────┬────────────┐
│ セット名      │ 作成日時             │ ファイル数   │
├──────────────┼─────────────────────┼────────────┤
│ frontend     │ 2024-01-15 10:30:45 │ 5          │
│ backend      │ 2024-01-14 15:22:30 │ 3          │
│ fullstack    │ 2024-01-13 09:45:00 │ 8          │
└──────────────┴─────────────────────┴────────────┘
```

#### 実行例

```bash
# 基本的な使用方法
claudy list

# 詳細ログを表示
claudy list -v
```

### delete

保存済みセットを削除します。

```bash
claudy delete <name> [options]
```

#### 説明

指定したセットを削除します。デフォルトでは削除前に確認プロンプトが表示されます。削除したセットは復元できないため、注意して使用してください。

#### オプション

| オプション | 短縮形 | 説明 |
|-----------|--------|------|
| `--force` | `-f` | 確認なしで削除 |

#### 実行例

```bash
# 基本的な使用方法（確認プロンプトあり）
claudy delete old-project

# 確認なしで即座に削除
claudy delete temp -f

# 詳細ログを表示しながら削除
claudy delete unused-config -v
```

#### 注意事項

- 削除したセットは復元できません
- 削除後は`claudy list`で残りのセットを確認することを推奨

### migrate

旧形式の設定ディレクトリをXDG Base Directory仕様に移行します。

```bash
claudy migrate [options]
```

#### 説明

claudyの旧バージョンで使用していた設定ディレクトリ（`~/.claudy/`）を、XDG Base Directory仕様に準拠した新形式（`~/.config/claudy/`）に移行します。

#### オプション

| オプション | 短縮形 | 説明 |
|-----------|--------|------|
| `--force` | `-f` | 確認なしで移行を実行（現在未実装） |

#### 移行パス

- **旧形式**: `~/.claudy/`
- **新形式**: `~/.config/claudy/`（`XDG_CONFIG_HOME`環境変数で変更可能）

#### 実行例

```bash
# 基本的な使用方法
claudy migrate

# 詳細ログを表示しながら移行
claudy migrate -v
```

#### 注意事項

- 移行後、旧ディレクトリ（`~/.claudy/`）は手動で削除する必要があります
- 移行処理では自動的なバックアップは作成されません
- 事前に重要なデータのバックアップを推奨

## 使用例とワークフロー

### 新規プロジェクトでの設定

```bash
# 1. プロジェクトディレクトリに移動
cd ~/projects/my-new-app

# 2. claudyを初期化
claudy init

# 3. CLAUDE.mdファイルを作成
echo "# プロジェクト指示書" > CLAUDE.md

# 4. 設定を保存
claudy save initial-setup
```

### 複数プロジェクト間での設定共有

```bash
# プロジェクトAで設定を保存
cd ~/projects/project-a
claudy save shared-config -a

# プロジェクトBで設定を展開
cd ~/projects/project-b
claudy load shared-config
```

### 設定のバージョン管理

```bash
# 現在の設定をバージョン付きで保存
claudy save v1.0.0 -a

# 開発が進んだら新バージョンとして保存
claudy save v1.1.0 -a

# 必要に応じて以前のバージョンに戻す
claudy load v1.0.0 -f
```

### チーム開発での活用

```bash
# 開発環境用の設定を保存
claudy save dev-env

# ステージング環境用の設定を保存
claudy save staging-env

# 本番環境用の設定を保存
claudy save prod-env

# 環境に応じて設定を切り替え
claudy load dev-env  # 開発時
claudy load staging-env  # テスト時
```

## トラブルシューティング

### よくあるエラーと解決方法

#### 1. 「設定ファイルが見つかりません」エラー

**原因**: 現在のディレクトリにClaude設定ファイルが存在しない

**解決方法**:
```bash
# CLAUDE.mdファイルを作成
touch CLAUDE.md

# または、.claudeディレクトリ構造を作成
mkdir -p .claude/commands
```

#### 2. 「セット名が無効です」エラー

**原因**: 使用できない文字や予約名を使用している

**解決方法**:
- 英数字、ハイフン、アンダースコアのみを使用
- 255文字以内に収める
- 「profiles」以外の名前を使用

#### 3. 「アクセス権限がありません」エラー

**原因**: ファイルやディレクトリへの読み書き権限がない

**解決方法**:
```bash
# 権限を確認
ls -la ~/.config/claudy

# 必要に応じて権限を修正
chmod -R u+rw ~/.config/claudy
```

#### 4. 「ディスク容量が不足しています」エラー

**原因**: 保存先のディスク容量が不足

**解決方法**:
```bash
# ディスク使用状況を確認
df -h

# 不要なセットを削除
claudy list
claudy delete unused-set
```

### デバッグ方法

詳細な実行ログを確認するには、`--verbose`オプションを使用します：

```bash
# 詳細ログを有効にして実行
claudy save myproject --verbose

# エラーの詳細情報を確認
claudy load problematic-set -v
```

### ログの読み方

verboseモードでは以下の情報が表示されます：
- 実行中の処理ステップ
- ファイルパスの詳細
- エラー発生時のスタックトレース
- リトライ処理の状況

## FAQ

### Q: 保存したセットはどこに保管されますか？

A: プロジェクトごとの`.claudy/sets/`ディレクトリに保存されます。このディレクトリはGitで管理することも可能です。

### Q: グローバル設定とプロジェクト設定の違いは？

A: 
- **グローバル設定** (`~/.claude/`): すべてのプロジェクトで共通して使用される設定
- **プロジェクト設定** (`./CLAUDE.md`, `./.claude/`): 特定のプロジェクトでのみ使用される設定

### Q: セット名に日本語は使用できますか？

A: 現在のバージョンでは、セット名には英数字、ハイフン、アンダースコアのみが使用可能です。日本語や他の特殊文字は使用できません。

### Q: 複数のセットを一度に削除できますか？

A: 現在のバージョンでは、一度に削除できるのは1つのセットのみです。複数削除する場合は、個別に`claudy delete`コマンドを実行してください。

### Q: claudyの設定ファイル自体のバックアップは？

A: `.claudy/`ディレクトリ全体をバックアップすることで、すべての保存済みセットをバックアップできます：
```bash
# バックアップ作成
tar -czf claudy-backup.tar.gz .claudy/

# 復元
tar -xzf claudy-backup.tar.gz
```

### Q: 他のユーザーとセットを共有できますか？

A: はい、`.claudy/sets/`ディレクトリをGitリポジトリに含めることで、チームメンバーと設定を共有できます。

### Q: migrateコマンドはいつ使用すべきですか？

A: claudyの古いバージョン（XDG Base Directory対応前）からアップグレードした場合にのみ必要です。新規インストールの場合は不要です。

---

詳細情報やアップデート情報については、[GitHubリポジトリ](https://github.com/douhashi/claudy)をご確認ください。